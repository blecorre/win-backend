openapi: 3.0.3
info:
  title: LPMS-server api
  description: lpms server api with auth
  version: 0.0.1
components:
  securitySchemes:
    bearerAuth:
      type: 'http'
      scheme: 'bearer'
      bearerFormat: 'JWT'
  schemas:
    AdultGuest:
      type: object
      required:
        - type
        - count
      properties:
        type:
          type: string
          enum: ['ADT']
        count:
          type: number
          minimum: 1
    ChildGuest:
      type: object
      required:
        - type
        - count
      properties:
        type:
          type: string
          enum: ['CHD']
        count:
          type: number
          minimum: 0
        childrenAges:
          type: array
          items:
            type: number
            minimum: 2
            maximum: 12

    Email:
      description: An email
      type: string
      format: email
      example: contact@org.co.uk

    PhoneNumber:
      description: A phone number
      type: string
      pattern: '^([+]{0,1})([0-9- ()/]+)$'
      example: '+32123456789'

    Name:
      description: First, middle or last name
      type: string
      minLength: 1
      maxLength: 42
      example: 'Bob'

    Guest:
      description: A representation of a Guest
      type: object
      required: ['type']
      properties:
        type:
          description: The Guest type code as per IATA definitions
          type: string
          minLength: 3
          maxLength: 3
          enum:
            - ADT # Adult (12+y)
            - CHD # Child (2-11y)
            - INF # Infant without a seat (<2y)
          example: ADT
        count:
          description: Number of associated Guests of the same type
          type: integer
          example: 2
          default: 1
        civility:
          description: The civility of the Guest
          type: string
          enum:
            - MR
            - MRS
          example: 'MR'
        lastnames:
          description: The list of last names of this Guest
          type: array
          minItems: 1
          maxItems: 5
          items:
            $ref: '#/components/schemas/Name'
        firstnames:
          description: The list of first names of this Guest
          type: array
          minItems: 1
          maxItems: 5
          items:
            $ref: '#/components/schemas/Name'
        middlenames:
          description: The list of middle names of this Guest
          type: array
          minItems: 1
          maxItems: 5
          items:
            $ref: '#/components/schemas/Name'
        gender:
          description: The gender of the Guest
          type: string
          enum:
            - Male
            - Female
          example: Male
        birthdate:
          description: The birthdate of the Guest
          type: string
          format: date-time
          example: '1980-03-21'
        contactInformation:
          description: The contact informations of the Guest
          type: array
          minItems: 1
          items:
            oneOf:
              - $ref: '#/components/schemas/PhoneNumber'
              - $ref: '#/components/schemas/Email'
      example:
        {
          'type': 'ADT',
          'lastnames': ['Marley'],
          'firstnames': ['Bob'],
          'gender': 'Male',
          'birthdate': '1980-03-21',
          'contactInformation': ['+32123456789', 'contact@org.co.uk']
        }

    Amount:
      description: An amount
      type: string
      pattern: '^[0-9]+(\.[0-9]+){0,1}$'
      minLength: 1
      maxLength: 99
      example: '40.00'

    Currency:
      description: The ISO4217 currency code
      type: string
      pattern: '^[A-Z]{3}$'
      minLength: 3
      maxLength: 3
      example: 'EUR'

    Price:
      description: Price of the service
      type: object
      required:
        - currency
        - public
      properties:
        currency:
          $ref: '#/components/schemas/Currency'
        private:
          $ref: '#/components/schemas/Amount'
        public:
          $ref: '#/components/schemas/Amount'
        commission:
          $ref: '#/components/schemas/Amount'
        taxes:
          $ref: '#/components/schemas/Amount'
        isAmountBeforeTax:
          type: boolean
        decimalPlaces:
          type: number

    PricePlansReferences:
      description: Maps a price plan with the associated elements
      type: object
      additionalProperties:
        type: object
        properties:
          accommodation:
            description: reference of the accommodation
            type: string
            example: 'prov.1234'
          roomType:
            description: reference of the room type in the accommodation
            type: string
            example: 'ND'
      example: { 'BAR': { 'accommodation': 'prov.1234', 'roomType': 'ND' } }

    Offer:
      description: An offer object
      type: object
      required:
        - expiration
        - price
        - pricePlansReferences
      properties:
        expiration:
          $ref: '#/components/schemas/Expiration'
        price:
          $ref: '#/components/schemas/Price'
        pricePlansReferences:
          $ref: '#/components/schemas/PricePlansReferences'

    MediaItem:
      description: Photo or Image
      type: object
      properties:
        type:
          type: string
          enum:
            - photo
            - video
        width:
          type: integer
        height:
          type: integer
        url:
          type: string
          format: url

    Media:
      type: array
      nullable: true
      items:
        $ref: '#/components/schemas/MediaItem'

    Location:
      description: An accommodation location object
      type: object
      required:
        - type
        - coordinates
      properties:
        type:
          type: string
        coordinates:
          type: array
          items:
            type: number

    AccommodationType:
      description: Type of accommodation service
      type: string
      maxLength: 24
      enum:
        - hotel
      example: 'hotel'

    ContactAddress:
      description: Address of a hotel
      type: object
      required: ['country', 'streetAddress', 'locality']
      properties:
        streetAddress:
          description: address line
          type: string
          example: Maskingatan 11
        premise:
          type: string
          example: Gota Alv River
        locality:
          description: city name
          type: string
          example: Gothenburg
        postalCode:
          description: postal code
          type: string
          example: 417 64
        country:
          description: country
          type: string
          example: 'China'

    ContactInformation:
      type: object
      properties:
        phoneNumbers:
          type: array
          items:
            $ref: '#/components/schemas/PhoneNumber'
        emails:
          type: array
          items:
            $ref: '#/components/schemas/Email'
        address:
          $ref: '#/components/schemas/ContactAddress'

    CheckInOutPolicy:
      description: The check-in and check-out time policy, format HH:MM
      type: object
      properties:
        checkinTime:
          type: string
          pattern: '^[0-9]{2}:[0-9]{2}$'
          example: '15:00'
        checkoutTime:
          type: string
          pattern: '^[0-9]{2}:[0-9]{2}$'
          example: '11:00'

    RoomAmenities:
      description: The list of amenities available with this room type
      type: object
      required: ['name', 'description', 'otaCode']
      properties:
        name:
          description: The name of this amenity
          type: string
          nullable: true
        description:
          description: Description of the amenity
          type: string
          nullable: true
        otaCode:
          description: The OTA code for this amenity
          type: string

    RoomSize:
      description: the size of the room
      type: object
      nullable: true
      properties:
        value:
          description: The size value of this room
          type: number
          example: 15
        unit:
          description: The unit for this room size
          type: string
          enum:
            - metric
            - imperial
          example: metric
          default: metric

    RoomOccupancy:
      description: Maximum occupancy for this room type
      type: object
      required: ['adults', 'children']
      properties:
        adults:
          type: integer
        children:
          type: integer

    RoomPolicies:
      type: object
      additionalProperties:
        type: string

    RoomTypes:
      description: A room type object
      type: object
      required:
        - name
        - description
        - amenities
        - size
        - maximumOccupancy
        - media
        - policies
      properties:
        name:
          description: The name of this room type
          type: string
          example: Twin beds
        description:
          description: A description of the room type
          type: string
          example: Standard twin rooms with two single beds
        amenities:
          type: array
          items:
            $ref: '#/components/schemas/RoomAmenities'
        size:
          $ref: '#/components/schemas/RoomSize'
        maximumOccupancy:
          $ref: '#/components/schemas/RoomOccupancy'
        media:
          $ref: '#/components/schemas/Media'
        policies:
          $ref: '#/components/schemas/RoomPolicies'

    Accommodation:
      description: An accommodation object
      type: object
      required:
        - id
        - hotelId
        - name
        - type
        - description
        - location
        - rating
        - contactInformation
        - checkinoutPolicy
        - otherPolicies
        - media
        - roomTypes
      properties:
        location:
          $ref: '#/components/schemas/Location'
        _id:
          description: mongo id of the hotel
          type: string
        id:
          description: uuid of the hotel (offer)
          type: string
        hotelId:
          description: Id of the hotel
          type: string
          example: 'GOH202'
        name:
          description: The name of the property or accommodation
          type: string
          example: Comfort Hotel Xpress Stockholm Central
        type:
          $ref: '#/components/schemas/AccommodationType'
        description:
          description: The description of the property
          type: string
        rating:
          description: The award rating as per country rules
          type: integer
          example: 3
        contactInformation:
          $ref: '#/components/schemas/ContactInformation'
        checkinoutPolicy:
          $ref: '#/components/schemas/CheckInOutPolicy'
        otherPolicies:
          type: array
          items:
            type: string
        media:
          $ref: '#/components/schemas/Media'
        roomTypes:
          description: Type of rooms available for this accommodation
          type: object
          additionalProperties:
            $ref: '#/components/schemas/RoomTypes'

    # @todo Review this definition is it still required
    PricePlan:
      description: Describes the attributes of the price plan
      type: object
      properties:
        name:
          description: The marketing name of this price plan
          type: string
          maxLength: 24
          example: 'Premium Economy'
        amenities:
          description: The amenities for this price plan
          type: array
          maxItems: 99
          items:
            type: string
            example: meal
        checkedBaggages:
          description: the list of checked checkedBaggages
          type: object
          properties:
            quantity:
              type: integer
              example: 2

    SearchResults:
      description: An object to return search results
      type: object
      nullable: true
      required:
        - offers
        - accommodations
      properties:
        offers:
          description: The indexed list of offers
          type: object
          additionalProperties:
            $ref: '#/components/schemas/Offer'
        accommodations:
          description: The accommodations matching an search request
          type: object
          additionalProperties:
            $ref: '#/components/schemas/Accommodation'
        pricePlans:
          description: The indexed list of price plans
          type: object
          additionalProperties:
            $ref: '#/components/schemas/PricePlan'
        passengers:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/Guest'
          example:
            PAX1: { 'type': 'ADT' }

    UUID:
      description: Unique identifier for Offers and Orders
      type: string
      format: uuid
      minLength: 36
      maxLength: 36
      pattern: '^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$'
      example: '11111111-2222-3333-4444-000000000001'

    Address:
      description: address
      type: string
      minLength: 42
      maxLength: 42
      pattern: '^0x[a-fA-F0-9]{40}$'
      example: '0x0000000000000000000000000000000000000000'

    TaxItem:
      description: A tax item
      type: object
      properties:
        amount:
          $ref: '#/components/schemas/Amount'
        code:
          type: string
          pattern: '^[A-Z0-9]{2}$'
          example: CA
        description:
          type: string
          example: Air Travellers Security Charge (ATSC)

    FareComponentItem:
      type: object
      properties:
        name:
          description: The name of the fare component
          type: string
          example: Basic
        basisCode:
          description: The Fare Basis code of the fare component
          type: string
          pattern: '^[A-Z0-9]+$'
          example: A30ZABA
        designator:
          description: The Reservation Booking Designator (RBD)
          type: string
          pattern: '^[A-Z]{1}$'
          example: A
        conditions:
          description: The fare conditions associated with the fare component
          type: string
          example: 'No flight changes are permitted.'

    FareItem:
      description: A fare item
      type: object
      properties:
        amount:
          $ref: '#/components/schemas/Amount'
        description:
          type: string
          example: Navigation Surcharge
        usage:
          description: The usage of the fare item
          type: string
          enum:
            - base # Base Fare
            - surcharge # Surcharge
          default: base
        code:
          description: The optional code of the fare item
          type: string
          pattern: '^[A-Z0-9]{2}$'
          example: S1
        components:
          description: A fare component
          type: array
          items:
            $ref: '#/components/schemas/FareComponentItem'

    PriceItem:
      description: Detail of a priced item
      type: object
      properties:
        taxes:
          description: Taxes included in the price
          type: array
          items:
            $ref: '#/components/schemas/TaxItem'
        fare:
          description: Breakdown of the fare
          type: array
          items:
            $ref: '#/components/schemas/FareItem'

    Disclosures:
      description: List of disclosures
      nullable: true
      type: array
      items:
        type: array
        items:
          type: string
          nullable: true
          example: 'The seat charge is applicable to each one-way flight...'

    Expiration:
      description: The offer expiration time.
      type: string
      format: date-time
      example: '2021-04-12T23:20:50.52Z'

    PricedOfferContent:
      type: object
      required:
        - expiration
        - price
        - pricedItems
        - disclosures
      properties:
        expiration:
          $ref: '#/components/schemas/Expiration'
        price:
          $ref: '#/components/schemas/Price'
        pricedItems:
          description: Breakdown of items priced
          type: array
          items:
            $ref: '#/components/schemas/PriceItem'
        disclosures:
          $ref: '#/components/schemas/Disclosures'

    PricedOffer:
      description: An offer with confirmed price
      type: object
      required:
        - offerId
        - offer
        - accommodation
        - provider
        - serviceId
      properties:
        offerId:
          $ref: '#/components/schemas/UUID'
        offer:
          $ref: '#/components/schemas/PricedOfferContent'
        accommodation:
          $ref: '#/components/schemas/Accommodation'
        provider:
          type: string
        serviceId:
          type: string

    OfferDbValue:
      description: offer in db structure
      type: object
      required:
        - _id
        - id
        - accommodation
        - pricedItems
        - disclosures
        - price
        - pricePlansReferences
        - expiration
        - arrival
        - departure
      properties:
        _id:
          type: string
        id:
          type: string
        accommodation:
          $ref: '#/components/schemas/Accommodation'
        pricedItems:
          type: array
          items:
            $ref: '#/components/schemas/PriceItem'
        disclosures:
          $ref: '#/components/schemas/Disclosures'
        price:
          $ref: '#/components/schemas/Price'
        pricePlansReferences:
          $ref: '#/components/schemas/PricePlansReferences'
        expiration:
          $ref: '#/components/schemas/Expiration'
        arrival:
          type: string
          format: date-time
        departure:
          type: string
          format: date-time

    Deal:
      description: db value of deal
      type: object
      required:
        - offer
        - offerId
        - createdAt
        - status
      properties:
        offer:
          $ref: '#/components/schemas/OfferDbValue'
        offerId:
          type: string
        createdAt:
          type: string
          format: date-time
        status:
          type: string
          enum: ['paid', 'pending', 'booked', 'paymentError']
        message:
          type: string
        orderId:
          type: string

    BookingRecord:
      description: Complete booking information object
      type: object
      allOf:
        - $ref: '#/components/schemas/Deal'
      properties:
        message:
          type: string
        orderId:
          type: string

    BookingResponse:
      description: Bookings of address
      type: array
      items:
        $ref: '#/components/schemas/BookingRecord'

    OffersSearchRequest:
      description: Offers search request
      type: object
      required:
        - accommodation
        - passengers
      properties:
        accommodation:
          type: object
          required:
            - location
            - arrival
            - departure
            - roomCount
          properties:
            location:
              type: object
              required:
                - lon
                - lat
                - radius
              properties:
                lon:
                  type: number
                lat:
                  type: number
                radius:
                  type: number
            arrival:
              type: string
              format: date-time
            departure:
              type: string
              format: date-time
            roomCount:
              type: number
              minimum: 1
        passengers:
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/AdultGuest'
              - $ref: '#/components/schemas/ChildGuest'

    BookingsAuthRequest:
      description: Wallet authentication request
      type: object
      required:
        - chainId
        - signature
        - secret
        - wallet
      properties:
        chainId:
          type: number
          description: chain id
        signature:
          type: string
        secret:
          type: string
        wallet:
          type: string
          description: address

    BookingsAuthSecretResponse:
      description: Bookings authentication secret response
      type: object
      required:
        - secret
      properties:
        secret:
          type: string

    BookingsAuthResponse:
      description: Bookings authentication response
      type: object
      required:
        - accessToken
        - refreshToken
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string

    RewardOption:
      description: option regarding the form of the reward
      type: object
      required:
        - rewardType
        - quantity
        - tokenName
      properties:
        rewardType:
          $ref: '#/components/schemas/RewardType'
        quantity:
          pattern: '^[0-9]+(.[0-9]+)?$'
          type: string
        tokenName:
          type: string

    RewardChoice:
      description: choice regarding the form of the reward
      type: object
      properties:
        rewardType:
          $ref: '#/components/schemas/RewardType'

    RewardType:
      description: form of the reward
      type: string
      enum: ['CO2_OFFSET', 'TOKEN']

    ErrorResponse:
      description: error response;
      type: object
      required:
        - status
        - message
      properties:
        status:
          type: boolean
          enum: [false]
        message:
          type: string

    SuccessResponse:
      description: error response;
      type: object
      required:
        - status
      properties:
        status:
          type: boolean
          enum: [true]

    SetPassengersResponse:
      description: error response;
      type: object
      required:
        - expiration
      properties:
        expiration:
          type: string
          format: 'date-time'

servers:
  - url: http://localhost:5000/api
    description: local server
  - url: https://test-win-backend-api.win.so/api
    description: dev server

paths:
  #users
  /user/login:
    post:
      summary: get access token
      tags: [Auth service]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - login
                - password
              properties:
                login:
                  type: string
                  description: user's login
                password:
                  type: string
                  description: user's password
      responses:
        200:
          content:
            application/json:
              schema:
                type: object
                required:
                  - id
                  - login
                  - roles
                  - accessToken
                  - refreshToken
                properties:
                  id:
                    type: string
                  login:
                    type: string
                  roles:
                    type: array
                    items:
                      type: string
                    minItems: 1
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
          description: It's ok
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /user/refresh:
    post:
      summary: refresh access token
      tags: [Auth service]
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                type: object
                required:
                  - accessToken
                  - refreshToken
                properties:
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /user/get-all:
    get:
      summary: get all users
      tags: [Auth service]
      responses:
        200:
          description: get all users
          content:
            application/json:
              schema:
                type: object
                required:
                  - users
                properties:
                  users:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        login:
                          type: string
                        roles:
                          type: array
                          items:
                            type: string
                          minItems: 1
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /user/create:
    post:
      security:
        - bearerAuth: []
      summary: create a new user (only for manager role)
      tags: [Auth service]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - login
                - password
                - roles
              properties:
                login:
                  type: string
                  description: user's login
                password:
                  type: string
                  description: user's password
                roles:
                  type: array
                  minItems: 1
                  items:
                    type: string
                    enum: [manager, staff]
                  description: roles (staff, manager)
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /user/update-password:
    put:
      security:
        - bearerAuth: []
      summary: update password
      tags: [Auth service]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - password
              properties:
                userId:
                  type: string
                  description: user's id
                password:
                  type: string
                  description: new user password
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /user/update-roles:
    put:
      security:
        - bearerAuth: []
      summary: update role (only for manager role)
      tags: [Auth service]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - roles
              properties:
                userId:
                  type: string
                  description: user's id
                roles:
                  type: array
                  minItems: 1
                  items:
                    type: string
                    enum: [manager, staff]
                  description: roles (staff, manager)
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /user:
    delete:
      security:
        - bearerAuth: []
      summary: delete user (only for manager role)
      tags: [Auth service]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
              properties:
                userId:
                  type: string
                  description: user's id
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /user/logout:
    post:
      security:
        - bearerAuth: []
      summary: logout
      tags: [Auth service]
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /bookings/auth/secret:
    get:
      summary: get secret
      tags: [Auth service]
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingsAuthSecretResponse'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /bookings/auth:
    post:
      summary: auth
      tags: [Auth service]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookingsAuthRequest'
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingsAuthResponse'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /bookings/auth/refresh:
    post:
      summary: refresh
      tags: [Auth service]
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingsAuthResponse'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  #end users

  #proxy
  /hotels/offers/search:
    post:
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OffersSearchRequest'
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResults'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /hotels/offers/{offerId}/price:
    post:
      parameters:
        - in: path
          name: offerId
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PricedOffer'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    get:
      parameters:
        - in: path
          name: offerId
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PricedOffer'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /hotels/{accommodationId}:
    get:
      parameters:
        - in: path
          name: accommodationId
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResults'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  #end proxy

  #booking
  /booking/{address}:
    get:
      parameters:
        - in: path
          name: address
          required: true
          schema:
            $ref: '#/components/schemas/Address'
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingResponse'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /booking/{offerId}/guests:
    parameters:
      - in: path
        name: offerId
        required: true
        schema:
          $ref: '#/components/schemas/UUID'
    post:
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/Guest'
              minItems: 1
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SetPassengersResponse'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /booking/{offerId}/rewardOptions:
    parameters:
      - in: path
        name: offerId
        required: true
        schema:
          $ref: '#/components/schemas/UUID'
    get:
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RewardOption'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /booking/{offerId}/reward:
    parameters:
      - in: path
        name: offerId
        required: true
        schema:
          $ref: '#/components/schemas/UUID'
    post:
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RewardChoice'

      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        400:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Handled Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Some server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  #end booking

  #health
  /health:
    get:
      responses:
        200:
          description: It's ok
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  commit:
                    type: string
  #end health
